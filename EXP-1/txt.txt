#include "DHT.h"
 
// --- SENSOR DEFINITIONS ---
#define DHTPIN 16      // DHT11 data pin connected to GPIO4
#define DHTTYPE DHT11  // DHT11 type
DHT dht(DHTPIN, DHTTYPE);
 
// Flame sensor and outputs
const int flameSensorPin = 14;  // Flame sensor digital output connected to GPIO15
const int buzzerPin = 22;       // Buzzer connected to GPIO13
const int ledPin = 5;           // LED connected to GPIO2
 
void setup() {
  pinMode(flameSensorPin, INPUT);
  pinMode(buzzerPin, OUTPUT);
  pinMode(ledPin, OUTPUT);
 
  digitalWrite(buzzerPin, LOW);
  digitalWrite(ledPin, LOW);
 
  Serial.begin(115200);
  dht.begin();
}
 
void loop() {
  int flameState = digitalRead(flameSensorPin);
  float t = dht.readTemperature();
  // Read temperature as Fahrenheit (isFahrenheit = true)
  float h = dht.readHumidity();
  float temperature = dht.computeHeatIndex(t, h, false);
 
  if (isnan(temperature)) {
    Serial.println("Failed to read from DHT sensor!");
    delay(500);
    return;
  }
 
  bool fireDetected = false;
 
  // Fire detection logic
  if (flameState == LOW) {
    fireDetected = true;  // Flame sensor triggered
  }
  if (temperature > 40.0) {
    fireDetected = true;  // Temperature too high
  }
 
  if (fireDetected) {
    Serial.print("FIRE DETECTED! Temp: ");
    Serial.println(temperature);
    digitalWrite(buzzerPin, HIGH);
    digitalWrite(ledPin, HIGH);
  } else {
    Serial.print("Safe. Temp: ");
    Serial.println(temperature);
    digitalWrite(buzzerPin, LOW);
    digitalWrite(ledPin, LOW);
  }
 
  delay(1000);  // check every second
}
